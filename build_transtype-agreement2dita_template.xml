<project name="dita2agreementToDita" default="dita2agreement2Dita.init" basedir=".">

 <!-- import xml task library -->
 <import file="xmltask/build.xml"/>

 <dirname property="dita2agreement2Dita.dir" file="${ant.file.dita2agreementToDita}"/>
 
 <property name="temp.dir" value="${output.dir}/temp"/>
 <mkdir dir="${temp.dir}"/>
 
 <property name="src.dir" value="${output.dir}/src"/>
 <mkdir dir="${src.dir}"/>
 
 <target name="dita2agreement2dita" depends="dita2agreement2Dita.init"> </target>

 <target name="dita2agreement2Dita.init" depends="define.xmlTask, dita2agreement2Dita.processLanguage"/> 

 <target name="dita2agreement2Dita.processLanguage" description="process agreement conversion in 2 languages">
  <antcall target="dita2agreement2Dita.process.elements">
   <param name="lang" value="fr"/>
  </antcall>
  <antcall target="dita2agreement2Dita.process.elements">
   <param name="lang" value="en"/>
  </antcall>
 </target>


 <target name="dita2agreement2Dita.split.language">
  <xslt in="${args.input}" out="${temp.dir}/splitted.xml" style="${dita2agreement2Dita.dir}/xsl/filter-${lang}.xsl" >
   <factory name="net.sf.saxon.TransformerFactoryImpl"/>
   <xmlcatalog>
    <dtd
     publicId="-//uottawa//agreement.dtd"
     location="dtd/agreement.dtd"/>
   </xmlcatalog>
  </xslt> 
 </target>

 <target name="dita2agreement2Dita.process.elements" depends="dita2agreement2Dita.split.language">

  <xslt in="${temp.dir}/splitted.xml" out="${temp.dir}/step-1-${lang}.xml" style="${dita2agreement2Dita.dir}/xsl/step-1.xsl" force="true">
   <factory name="net.sf.saxon.TransformerFactoryImpl"/>
  </xslt>

  <xslt in="${temp.dir}/step-1-${lang}.xml" out="${src.dir}/step-2-${lang}.xml" style="${dita2agreement2Dita.dir}/xsl/step-2.xsl" force="true">
   <factory name="net.sf.saxon.TransformerFactoryImpl"/>
  </xslt>

  <xslt basedir="${src.dir}" destdir="${output.dir}/${lang}" extension=".dita" style="${dita2agreement2Dita.dir}/xsl/main.xsl" filenameparameter="FILENAME"
   filedirparameter="DIRNAME" force="yes" reloadstylesheet="yes">
   <factory name="net.sf.saxon.TransformerFactoryImpl"/>
  </xslt>

 </target>

</project>
