<project name="dita2agreementToDita" default="dita2agreement2Dita.init" basedir=".">

 <!-- import xml task library -->
 <import file="xmltask/build.xml"/>

  <target name="dita2agreement2Dita.prepare">
    <dirname property="dita2agreement2Dita.dir" file="${ant.file.dita2agreementToDita}"/>

    <property name="temp.dir" value="${output.dir}/temp"/>
    <property name="src.dir" value="${output.dir}/src"/>
 
    <delete dir="${temp.dir}" />
    <delete dir="${src.dir}" />
 
    <mkdir dir="${src.dir}"/>
    <mkdir dir="${temp.dir}"/>
  </target>
 
 <target name="dita2agreement2dita" depends="dita2agreement2Dita.init"> </target>

 <target name="dita2agreement2Dita.init" depends="define.xmlTask, dita2agreement2Dita.prepare, dita2agreement2Dita.processLanguage"/>

 <target name="dita2agreement2Dita.processLanguage" description="process agreement conversion in 2 languages">
  <antcall target="dita2agreement2Dita.process.elements">
   <param name="lang" value="fr"/>
  </antcall>
  <antcall target="dita2agreement2Dita.process.elements">
   <param name="lang" value="en"/>
  </antcall>
 </target>


 <target name="dita2agreement2Dita.split.language">
 
 <echo>
  	+++ Processing ${args.input} with ${dita2agreement2Dita.dir}/xsl/filter-${lang}.xsl to ${temp.dir}/splitted-${lang}.xml
  </echo>
  
  <delete file="${temp.dir}/splitted-${lang}.xml" />
  <xslt in="${args.input}" out="${temp.dir}/splitted-${lang}.xml" style="${dita2agreement2Dita.dir}/xsl/filter-${lang}.xsl">
   <factory name="net.sf.saxon.TransformerFactoryImpl"/>
   <xmlcatalog>
    <dtd publicId="-//uottawa//agreement.dtd" location="dtd/agreement.dtd"/>
   </xmlcatalog>
  </xslt>
 </target>

 <target name="dita2agreement2Dita.process.elements" depends="dita2agreement2Dita.split.language">
  
  <xslt in="${temp.dir}/splitted-${lang}.xml" out="${temp.dir}/step-1-${lang}.xml"
   style="${dita2agreement2Dita.dir}/xsl/step-1.xsl" force="true" failOnError="false">
   <factory name="net.sf.saxon.TransformerFactoryImpl"/>
  </xslt>
  
  <xslt in="${temp.dir}/step-1-${lang}.xml" out="${src.dir}/${lang}/step-2.xml"
   style="${dita2agreement2Dita.dir}/xsl/step-2.xsl" force="true" failOnError="false">
   <factory name="net.sf.saxon.TransformerFactoryImpl"/>
  </xslt>
  
  <mkdir dir="${src.dir}/${lang}" />

  <xslt basedir="${src.dir}/${lang}" destdir="${output.dir}/${lang}" extension=".dita"
   style="${dita2agreement2Dita.dir}/xsl/main.xsl" filenameparameter="FILENAME" filedirparameter="DIRNAME" force="yes"
   reloadstylesheet="yes" failOnError="false">
   <factory name="net.sf.saxon.TransformerFactoryImpl"/>
  </xslt>

 </target>

</project>
